# 发送修复

更高级的用户可能能够通过发送补丁来修复程序中的问题。

补丁是描述对一个或多个参考文件进行更改的文件。具体来说，它包含要从代码中删除或添加的行，以及（有时）来自参考文本的行，这些行替换了修改后的上下文（如果行号发生了变化，它们帮助确定修改的位置）。

用于应用此类文件中给定修改的工具被简单地称为 `patch`。用于创建补丁文件的工具是 `diff`，使用方法如下：

```
$ diff -u file.old file.new > file.patch
```

`file.patch` 文件包含了将 `file.old` 转换为 `file.new` 的修改说明。我们可以将它发送给别人，然后对方可以使用它来从另外两个文件中重新生成 `file.new`，方法如下：

```
$ patch < file.patch
```

现在，`file.old` 与 `file.new` 完全相同。

实际上，大多数软件当前都托管在 Git 仓库中，贡献者因此更可能使用 `git` 来获取源代码并提出更改。`git diff` 会生成与 `diff -u` 相同格式的文件，而 `git apply` 可以像 `patch` 一样应用补丁。

**_文化_ Git**

Git 是一个协作工具，允许多人共同处理多个文件，同时保留修改的历史记录。涉及的文件通常是文本文件，比如程序的源代码。如果多人在同一个文件上工作，`git` 只能合并对不同部分的修改。如果修改发生在同一部分，这些“冲突”必须手动解决。

Git 是一个分布式系统，每个用户都有一个包含完整修改历史的本地仓库。中央仓库用于下载项目（`git clone`）和与他人共享已完成的工作（`git push`）。仓库可以包含多个文件版本，但一次只能工作在一个版本上：这个版本称为工作副本（可以通过 `git checkout` 切换到另一个版本）。Git 可以显示工作副本的修改（`git diff`），可以暂存待纳入版本历史的修改（`git add`），并且可以创建新的提交条目（`git commit`）。它还可以更新工作副本，以包括其他用户平行修改的内容（`git pull`），并可以记录特定配置以便后续轻松提取（`git tag`）。

Git 使得在开发过程中轻松处理多个并行版本而不互相干扰成为可能。这些版本被称为 _分支_。这个树的隐喻很准确，因为程序最初是在一个共同的主干上开发的。当一个里程碑（如 1.0 版本）达到时，开发将继续在两个分支上进行：开发分支准备下一个主要版本，而维护分支负责管理 1.0 版本的更新和修复。

Git 目前是最流行的版本控制系统，但它并不是唯一的。历史上，CVS（并行版本系统）是第一个广泛使用的工具，但由于其众多限制，催生了更多现代的自由替代工具，尤其是 `Subversion`（`svn`）、`Git`（`git`）、`Bazaar`（`bzr`）、`Fossil`（`fossil`）和 `Mercurial`（`hg`）。

→ [https://www.nongnu.org/cvs/](https://www.nongnu.org/cvs/)

→ [https://subversion.apache.org/](https://subversion.apache.org/)

→ [https://git-scm.com/](https://git-scm.com/)

→ [https://bazaar.canonical.com/](https://bazaar.canonical.com/)

→ [http://mercurial.selenic.com/](http://mercurial.selenic.com/)

本书的范围不包括对 Git 的详细解释。如需详细了解，请参考 _Pro Git_ 书籍。

→ [https://git-scm.com/book/](https://git-scm.com/book/)

虽然 `git diff` 的输出是可以与其他开发者共享的文件，但通常有更好的方式来提交更改。如果开发者倾向于通过电子邮件获取补丁，他们通常希望使用 `git format-patch` 生成补丁，以便他们可以直接通过 `git am` 将其集成到仓库中。这可以保留提交的元信息，并使得一次性共享多个提交成为可能。

这种基于电子邮件的工作流程仍然很流行，但当软件托管在如 GitHub 或 GitLab 这样的平台上时，通常会被 _合并请求_（或 _拉取请求_）所取代——而 Debian 正在其 `salsa.debian.org` 服务器上使用 GitLab。在这些系统上，一旦你创建了账户，就可以 _fork_ 仓库，实际上是在你自己的账户中创建该仓库的副本，然后你可以克隆该仓库并推送自己的更改。然后，网页界面会建议你提交一个合并请求，通知开发者你的更改，使他们能够轻松地通过一次点击来审查并接受你的修改。